<?php 
	if(__FILE__ != $_SERVER['SCRIPT_FILENAME']) {
		echo "<!DOCTYPE html>\n";
		echo "<title>Auto-Snake</title>\n";
	}
?>
<div id="snake">
	<style type="text/css" scoped>
		#snake-canvas {
			border: 1px solid;
			display: block;
			margin: 0 auto;	
			background-color: white;
		}
		#snake {
			width: 480px;
			margin: 0 auto;
			background: #E2E3E4;
			padding: 10px;
		 	-moz-border-radius: 10px;
		    -webkit-border-radius: 10px;
		    border-radius: 10px;
			text-align: center;
		}
		.snake-btn {
			background-color: green;
			color: white;
			padding: 10;
		 	-moz-border-radius: 10px;
		    -webkit-border-radius: 10px;
		    border-radius: 10px;
	     	/*border: 2px solid #4CAF50;*/

		}
		#snake-selected {
			background-color: darkred;
		}
	</style>
	<canvas id="snake-canvas" width="480" height="320"></canvas>
	<br>
	<button type="button" class="snake-btn" onclick="SNAKE.modSpeed(2);SNAKE.selectButton(this);">slow</button>
	<button type="button" class="snake-btn" onclick="SNAKE.modSpeed(1);SNAKE.selectButton(this);" id="snake-selected">normal</button>
	<button type="button" class="snake-btn" onclick="SNAKE.modSpeed(0.5);SNAKE.selectButton(this);">fast</button>
	<button type="button" class="snake-btn" onclick="SNAKE.modSpeed(0.1);SNAKE.selectButton(this);">FAST</button>
</div>
<script type="text/javascript">var SNAKE=function(t){function e(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}function r(){for(q=e(),x+=Math.min(z,(q-Q)/1e3);x>z*A;)x-=z*A,y(z);a(x/A),Q=q,T||requestAnimationFrame(r)}function i(){T&&(T=!1,d())}function n(t){A=t}function o(e){for(var r=t.getElementsByClassName("snake-btn"),i=0;i<r.length;i++)r[i].removeAttribute("id");e.id="snake-selected"}function a(){E.clearRect(0,0,B.width,B.height),s(),f(),u(),T&&h()}function h(){E.beginPath(),E.fillStyle="darkred",E.font="2em sans-serif",E.textAlign="center",E.fillText("Click to restart.",B.width/2,B.height/3),E.closePath()}function u(){E.beginPath(),E.rect(c(U)*C,p(U)*C,C,C),E.fillStyle="darkgreen",E.fill(),E.closePath()}function s(){E.beginPath();for(var t=0;t<H.length;t++)E.rect(c(H[t])*C,p(H[t])*C,C,C),E.fillStyle="green",E.fill();E.closePath()}function f(){E.beginPath(),E.rect(c(O)*C,p(O)*C,C,C),E.fillStyle="red",E.fill(),E.closePath()}function l(t,e){return t+e*N.width}function p(t){return Math.floor(t/N.width)}function c(t){return t%N.width}function d(){T=!1,U=l(Math.floor(N.width/2),Math.floor(N.height/2)),H=[U-1,U-2],O=g(),D=0,r()}function g(){for(var t=[],e=0;e<N.width*N.height;e++)H.indexOf(e)<0&&t.push(e);return t[Math.floor(Math.random()*t.length)]}function y(t){H.unshift(U),U===O?(D+=1,O=g()):H.pop();var e=U;if(U=P(U,O,H),Math.abs(c(U)-c(e))>0&&Math.abs(p(U)-p(e))>0)return void v();if(c(U)>=N.width||c(U)<0||p(U)>=N.height||p(U)<0)return void v();for(var r=0;r<H.length;r++)if(U===H[r])return void v()}function v(){T=!0}function m(t,e){return t>=0&&t<N.width&&e>=0&&e<N.height}function _(t,e){return-1===V.indexOf(l(t,e))}function w(t){var e=c(t),r=p(t),i=[[e+1,r],[e-1,r],[e,r-1],[e,r+1]];i=i.filter(function(t){return m(t[0],t[1])&&_(t[0],t[1])});for(var n=0;n<i.length;n++)i[n]=l(i[n][0],i[n][1]);return i}function b(t,e){var r=new PriorityQueue({comparator:function(t,e){return t.score-e.score}});r.queue({pos:t,score:0});var i={};for(i[t]=null;0!==r.length;){var n=r.dequeue().pos;if(n===e)break;for(var o=w(n),a=0;a<o.length;a++){var h=o[a];if(void 0===i[h]){var u=k(e,h);r.queue({pos:h,score:u}),i[h]=n}}}return i}function k(t,e){return Math.abs(c(t)-c(e))+Math.abs(p(t)-p(e))}function S(t,e,r){if(void 0===t[r])return null;for(var i=r,n=[i];i!==e;)i=t[i],n.push(i);return n.reverse(),n}function P(t,e,r){V=r;var i,n;if(i=b(t,e),n=S(i,t,e),void 0!==n&&null!==n)return n[1];var o=r[r.length-1];if(k(o,t)>1&&(V.pop(),i=b(t,r[r.length]),n=S(i,t,r[r.length]),void 0!==n&&null!==n))return n[1];var a=w(t);return 0!==a.length?a[Math.floor(Math.random()*a.length)]:t+1}var q,M={},x=0,Q=e(),z=.1,A=1,B=t.getElementById("snake-canvas"),E=B.getContext("2d");B.addEventListener("click",i),E.beginPath(),E.fillStyle="darkred",E.font="2em sans-serif",E.textAlign="center",E.fillText("Click to start.",B.width/2,B.height/3),E.closePath(),M.modSpeed=n,M.selectButton=o;var D,U,H,O,T=!0,C=20,N={width:Math.floor(B.width/C),height:Math.floor(B.height/C)},V=[];return!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.PriorityQueue=t()}}(function(){return function t(e,r,i){function n(a,h){if(!r[a]){if(!e[a]){var u="function"==typeof require&&require;if(!h&&u)return u(a,!0);if(o)return o(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var f=r[a]={exports:{}};e[a][0].call(f.exports,function(t){var r=e[a][1][t];return n(r?r:t)},f,f.exports,t,e,r,i)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(t,e,r){var i,n,o,a,h,u={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=t("./PriorityQueue/AbstractPriorityQueue"),n=t("./PriorityQueue/ArrayStrategy"),a=t("./PriorityQueue/BinaryHeapStrategy"),o=t("./PriorityQueue/BHeapStrategy"),h=function(t){function e(t){t||(t={}),t.strategy||(t.strategy=a),t.comparator||(t.comparator=function(t,e){return(t||0)-(e||0)}),e.__super__.constructor.call(this,t)}return s(e,t),e}(i),h.ArrayStrategy=n,h.BinaryHeapStrategy=a,h.BHeapStrategy=o,e.exports=h},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,e,r){var i;e.exports=i=function(){function t(t){if(null==(null!=t?t.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=t?t.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new t.strategy(t),this.length=0}return t.prototype.queue=function(t){return this.length++,void this.priv.queue(t)},t.prototype.dequeue=function(t){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},t.prototype.peek=function(t){if(!this.length)throw"Empty queue";return this.priv.peek()},t.prototype.clear=function(){return this.length=0,this.priv.clear()},t}()},{}],3:[function(t,e,r){var i,n;n=function(t,e,r){var i,n,o;for(n=0,i=t.length;i>n;)o=n+i>>>1,r(t[o],e)>=0?n=o+1:i=o;return n},e.exports=i=function(){function t(t){var e;this.options=t,this.comparator=this.options.comparator,this.data=(null!=(e=this.options.initialValues)?e.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return t.prototype.queue=function(t){var e;return e=n(this.data,t,this.comparator),void this.data.splice(e,0,t)},t.prototype.dequeue=function(){return this.data.pop()},t.prototype.peek=function(){return this.data[this.data.length-1]},t.prototype.clear=function(){return void(this.data.length=0)},t}()},{}],4:[function(t,e,r){var i;e.exports=i=function(){function t(t){var e,r,i,n,o,a,h,u,s;for(this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.pageSize=(null!=t?t.pageSize:void 0)||512,this.length=0,i=0;1<<i<this.pageSize;)i+=1;if(1<<i!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=i,this._emptyMemoryPageTemplate=e=[],r=o=0,u=this.pageSize;u>=0?u>o:o>u;r=u>=0?++o:--o)e.push(null);if(this._memory=[],this._mask=this.pageSize-1,t.initialValues)for(s=t.initialValues,a=0,h=s.length;h>a;a++)n=s[a],this.queue(n)}return t.prototype.queue=function(t){return this.length+=1,this._write(this.length,t),void this._bubbleUp(this.length,t)},t.prototype.dequeue=function(){var t,e;return t=this._read(1),e=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,e),this._bubbleDown(1,e)),t},t.prototype.peek=function(){return this._read(1)},t.prototype.clear=function(){return this.length=0,void(this._memory.length=0)},t.prototype._write=function(t,e){var r;for(r=t>>this._shift;r>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[r][t&this._mask]=e},t.prototype._read=function(t){return this._memory[t>>this._shift][t&this._mask]},t.prototype._bubbleUp=function(t,e){var r,i,n,o;for(r=this.comparator;t>1&&(i=t&this._mask,t<this.pageSize||i>3?n=t&~this._mask|i>>1:2>i?(n=t-this.pageSize>>this._shift,n+=n&~(this._mask>>1),n|=this.pageSize>>1):n=t-2,o=this._read(n),!(r(o,e)<0));)this._write(n,e),this._write(t,o),t=n},t.prototype._bubbleDown=function(t,e){var r,i,n,o,a;for(a=this.comparator;t<this.length;)if(t>this._mask&&!(t&this._mask-1)?r=i=t+2:t&this.pageSize>>1?(r=(t&~this._mask)>>1,r|=t&this._mask>>1,r=r+1<<this._shift,i=r+1):(r=t+(t&this._mask),i=r+1),r!==i&&i<=this.length)if(n=this._read(r),o=this._read(i),a(n,e)<0&&a(n,o)<=0)this._write(r,e),this._write(t,n),t=r;else{if(!(a(o,e)<0))break;this._write(i,e),this._write(t,o),t=i}else{if(!(r<=this.length))break;if(n=this._read(r),!(a(n,e)<0))break;this._write(r,e),this._write(t,n),t=r}},t}()},{}],5:[function(t,e,r){var i;e.exports=i=function(){function t(t){var e;this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.length=0,this.data=(null!=(e=t.initialValues)?e.slice(0):void 0)||[],this._heapify()}return t.prototype._heapify=function(){var t,e,r;if(this.data.length>0)for(t=e=1,r=this.data.length;r>=1?r>e:e>r;t=r>=1?++e:--e)this._bubbleUp(t)},t.prototype.queue=function(t){return this.data.push(t),void this._bubbleUp(this.data.length-1)},t.prototype.dequeue=function(){var t,e;return e=this.data[0],t=this.data.pop(),this.data.length>0&&(this.data[0]=t,this._bubbleDown(0)),e},t.prototype.peek=function(){return this.data[0]},t.prototype.clear=function(){return this.length=0,void(this.data.length=0)},t.prototype._bubbleUp=function(t){for(var e,r;t>0&&(e=t-1>>>1,this.comparator(this.data[t],this.data[e])<0);)r=this.data[e],this.data[e]=this.data[t],this.data[t]=r,t=e},t.prototype._bubbleDown=function(t){var e,r,i,n,o;for(e=this.data.length-1;r=(t<<1)+1,n=r+1,i=t,e>=r&&this.comparator(this.data[r],this.data[i])<0&&(i=r),e>=n&&this.comparator(this.data[n],this.data[i])<0&&(i=n),i!==t;)o=this.data[i],this.data[i]=this.data[t],this.data[t]=o,t=i},t}()},{}]},{},[1])(1)}),M}(document);</script>